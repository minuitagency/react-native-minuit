{"version":3,"names":["stepList","title","projectID","children","setTooltip","useGlobal","setIsLoading","showModal","setShowModal","useState","step","setStep","screenshotURI","setScreenshotURI","description","setDescription","__DEV__","React","useEffect","subscription","RNShake","addListener","data","console","log","remove","submitShake","length","Error","text","uri","uploadToCloud","path","moment","valueOf","cloudInstance","functions","httpsCallable","screenshot","e","message","Header","useCallback","SharedStyles","containerRowSpaceBetween","backgroundColor","Palette","darkPurple","padding","icons","back","height","width","tintColor","mainWhite","require","flex","Fonts","primary","bold","textAlign","marginBottom","borderRadius","overflow"],"sources":["ShakeProvider.js"],"sourcesContent":["import React, { useState, useCallback, useEffect, useGlobal } from 'reactn';\nimport { Text, Modal, View, Image, Pressable } from 'react-native';\nimport moment from 'moment';\n\nimport RNShake from '../../lib';\n\nimport { uploadToCloud } from '../actions/userActions';\n\nimport cloudInstance from '../config/cloud';\n\nimport { SharedStyles, Fonts, Palette } from '../styles';\n\nimport { icons } from '../assets/';\nimport Button from '../components/Buttons/Button';\nimport Input from '../components/Inputs/Input';\n\nconst stepList = [\n  { title: 'Envoyer un nouveau rapport' },\n  { title: 'Description du problème' },\n];\n\nexport default ({ projectID = null, children }) => {\n  const [, setTooltip] = useGlobal('_tooltip');\n  const [, setIsLoading] = useGlobal('_isLoading');\n\n  const [showModal, setShowModal] = useState(false);\n  const [step, setStep] = useState(0);\n\n  const [screenshotURI, setScreenshotURI] = useState(null);\n  const [description, setDescription] = useState(__DEV__ ? 'teeeeeeeest' : '');\n\n  React.useEffect(() => {\n    const subscription = RNShake.addListener((data) => {\n      console.log('hello', data);\n      setScreenshotURI(data);\n      setShowModal(true);\n    });\n\n    return () => {\n      subscription?.remove?.();\n    };\n  }, []);\n\n  useEffect(() => {\n    if (showModal === false) {\n      setScreenshotURI(null);\n      setDescription('');\n      setStep(0);\n    }\n  }, [showModal]);\n\n  const submitShake = async () => {\n    try {\n      if (description.length < 5) {\n        throw new Error('Description trop courte');\n      }\n\n      if (description.length > 250) {\n        throw new Error('Description trop longue');\n      }\n\n      if (!screenshotURI) {\n        throw new Error(\"Aucune capture d'écran détectée...\");\n      }\n\n      setIsLoading(true);\n      setTooltip({ text: 'Publication en cours ...' });\n\n      const { uri } = await uploadToCloud({\n        path: `shakes/${projectID}/${moment().valueOf()}.jpg`,\n        uri: screenshotURI,\n      });\n\n      await cloudInstance.functions().httpsCallable('shakes-submitNewShake')({\n        screenshot: uri,\n        description,\n        projectID,\n      });\n\n      setTooltip({ text: 'Publication effectuée !' });\n      setShowModal(false);\n    } catch (e) {\n      console.log(e.message);\n      setTooltip({ text: e.message });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const Header = useCallback(() => {\n    return (\n      <View\n        style={[\n          SharedStyles.containerRowSpaceBetween,\n          { backgroundColor: Palette.darkPurple, padding: 20 },\n        ]}\n      >\n        <Pressable\n          onPress={() => {\n            if (step === 0) {\n              setShowModal(false);\n            } else {\n              setStep(step - 1);\n            }\n          }}\n        >\n          <Image\n            resizeMode=\"contain\"\n            source={icons.back}\n            style={{ height: 30, width: 30, tintColor: Palette.mainWhite }}\n          />\n        </Pressable>\n\n        <Image\n          resizeMode=\"contain\"\n          source={require('../assets/images/logoFull.png')}\n          style={{ height: 30, width: 150 }}\n        />\n\n        <View style={{ width: 30 }} />\n      </View>\n    );\n  }, [step]);\n\n  return (\n    <>\n      <Pressable style={{ flex: 1 }}>\n        <View style={{ flex: 1 }}>{children}</View>\n      </Pressable>\n\n      <Modal\n        animationType=\"slide\"\n        visible={showModal}\n        onRequestClose={() => {\n          setShowModal(!showModal);\n        }}\n        presentationStyle={'formSheet'}\n      >\n        <Header />\n\n        <View\n          style={{\n            flex: 1,\n            padding: 20,\n            backgroundColor: '#13131a',\n          }}\n        >\n          <Text\n            style={[\n              Fonts.primary.bold(17, Palette.mainWhite),\n              { textAlign: 'center', marginBottom: 20 },\n            ]}\n          >\n            {stepList[step].title}\n          </Text>\n\n          {!step ? (\n            <View style={{ flex: 0.8, borderRadius: 10, overflow: 'hidden' }}>\n              <Image\n                resizeMode={'cover'}\n                style={{ flex: 1 }}\n                source={{\n                  uri: screenshotURI,\n                }}\n              />\n            </View>\n          ) : (\n            <Input\n              style={{ height: 300, backgroundColor: Palette.mainWhite }}\n              value={description}\n              onChange={setDescription}\n              isTextarea\n            />\n          )}\n\n          <Button\n            text={step === stepList.length - 1 ? 'Envoyer' : 'Continuer'}\n            primary\n            isAbsoluteBottom\n            textColor={Palette.mainWhite}\n            onPress={() => {\n              if (step === stepList.length - 1) {\n                submitShake();\n              } else {\n                setStep(step + 1);\n              }\n            }}\n          />\n        </View>\n      </Modal>\n    </>\n  );\n};\n"],"mappings":"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"}