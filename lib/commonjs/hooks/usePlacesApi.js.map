{"version":3,"names":["usePlacesApi","queryFields","queryCountries","language","minChars","query","apiKey","places","setPlaces","useState","placeDetails","setPlaceDetails","loadingPlaces","setLoadingPlaces","loadingDetails","setLoadingDetails","useEffect","length","search","buildCountryQuery","map","countryCode","join","_places","fetch","then","response","json","predictions","e","console","log","getPlaceData","place","place_id","result","clearSearch"],"sources":["usePlacesApi.js"],"sourcesContent":["import { useEffect, useState } from 'react';\n\nexport default function usePlacesApi({\n  queryFields = 'formatted_address,geometry,name,address_components',\n  queryCountries = ['fr'],\n  language = 'fr-FR',\n  minChars = 2,\n  query = '',\n  apiKey = '',\n}) {\n  const [places, setPlaces] = useState([]);\n  const [placeDetails, setPlaceDetails] = useState(null);\n  const [loadingPlaces, setLoadingPlaces] = useState(false);\n  const [loadingDetails, setLoadingDetails] = useState(false);\n\n  useEffect(() => {\n    if (query < minChars) {\n      setPlaces([]);\n      setPlaceDetails(null);\n    }\n    if (query?.length >= minChars && !loadingPlaces) {\n      search();\n    }\n  }, [query]);\n\n  function buildCountryQuery() {\n    if (!queryCountries) {\n      return '';\n    }\n    return `&components=${queryCountries\n      .map((countryCode) => {\n        return `country:${countryCode}`;\n      })\n      .join('|')}`;\n  }\n\n  async function search() {\n    try {\n      setLoadingPlaces(true);\n      const _places = await fetch(\n        `https://maps.googleapis.com/maps/api/place/autocomplete/json?input=${query}&key=${apiKey}&inputtype=textquery&language=${language}&fields=${queryFields}${buildCountryQuery()}`\n      ).then((response) => response.json());\n      setPlaces(_places?.predictions);\n    } catch (e) {\n      console.log(e);\n    } finally {\n      setLoadingPlaces(false);\n    }\n  }\n\n  async function getPlaceData(place) {\n    try {\n      if (loadingDetails) {\n        return;\n      }\n      setLoadingDetails(true);\n      const placeDetails = await fetch(\n        `https://maps.googleapis.com/maps/api/place/details/json?placeid=${place.place_id}&key=${apiKey}&fields=${queryFields}&language=${language}`\n      ).then((response) => response.json());\n      setPlaceDetails({ ...placeDetails?.result, ...place });\n    } catch (e) {\n      console.log(e);\n    } finally {\n      setLoadingDetails(false);\n    }\n  }\n\n  function clearSearch() {\n    setPlaces([]);\n    setPlaceDetails(null);\n  }\n\n  return { places, placeDetails, getPlaceData, clearSearch };\n}\n"],"mappings":"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"}