{"version":3,"names":["useEffect","useState","usePlacesApi","queryFields","queryCountries","language","minChars","query","apiKey","places","setPlaces","placeDetails","setPlaceDetails","loadingPlaces","setLoadingPlaces","loadingDetails","setLoadingDetails","length","search","buildCountryQuery","map","countryCode","join","_places","fetch","then","response","json","predictions","e","console","log","getPlaceData","place","place_id","result","clearSearch"],"sources":["usePlacesApi.js"],"sourcesContent":["import { useEffect, useState } from 'react';\n\nexport default function usePlacesApi({\n  queryFields = 'formatted_address,geometry,name,address_components',\n  queryCountries = ['fr'],\n  language = 'fr-FR',\n  minChars = 2,\n  query = '',\n  apiKey = '',\n}) {\n  const [places, setPlaces] = useState([]);\n  const [placeDetails, setPlaceDetails] = useState(null);\n  const [loadingPlaces, setLoadingPlaces] = useState(false);\n  const [loadingDetails, setLoadingDetails] = useState(false);\n\n  useEffect(() => {\n    if (query < minChars) {\n      setPlaces([]);\n      setPlaceDetails(null);\n    }\n    if (query?.length >= minChars && !loadingPlaces) {\n      search();\n    }\n  }, [query]);\n\n  function buildCountryQuery() {\n    if (!queryCountries) {\n      return '';\n    }\n    return `&components=${queryCountries\n      .map((countryCode) => {\n        return `country:${countryCode}`;\n      })\n      .join('|')}`;\n  }\n\n  async function search() {\n    try {\n      setLoadingPlaces(true);\n      const _places = await fetch(\n        `https://maps.googleapis.com/maps/api/place/autocomplete/json?input=${query}&key=${apiKey}&inputtype=textquery&language=${language}&fields=${queryFields}${buildCountryQuery()}`\n      ).then((response) => response.json());\n      setPlaces(_places?.predictions);\n    } catch (e) {\n      console.log(e);\n    } finally {\n      setLoadingPlaces(false);\n    }\n  }\n\n  async function getPlaceData(place) {\n    try {\n      if (loadingDetails) {\n        return;\n      }\n      setLoadingDetails(true);\n      const placeDetails = await fetch(\n        `https://maps.googleapis.com/maps/api/place/details/json?placeid=${place.place_id}&key=${apiKey}&fields=${queryFields}&language=${language}`\n      ).then((response) => response.json());\n      setPlaceDetails({ ...placeDetails?.result, ...place });\n    } catch (e) {\n      console.log(e);\n    } finally {\n      setLoadingDetails(false);\n    }\n  }\n\n  function clearSearch() {\n    setPlaces([]);\n    setPlaceDetails(null);\n  }\n\n  return { places, placeDetails, getPlaceData, clearSearch };\n}\n"],"mappings":"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"}