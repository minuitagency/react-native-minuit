{"version":3,"names":["React","useState","useCallback","useEffect","useGlobal","Text","Modal","View","Image","Pressable","moment","RNShake","uploadToCloud","cloudInstance","SharedStyles","Fonts","Palette","icons","Button","Input","stepList","title","projectID","children","setTooltip","setIsLoading","showModal","setShowModal","step","setStep","screenshotURI","setScreenshotURI","description","setDescription","__DEV__","subscription","addListener","data","console","log","remove","submitShake","length","Error","text","uri","path","valueOf","functions","httpsCallable","screenshot","e","message","Header","containerRowSpaceBetween","backgroundColor","darkPurple","padding","back","height","width","tintColor","mainWhite","require","flex","primary","bold","textAlign","marginBottom","borderRadius","overflow"],"sources":["ShakeProvider.js"],"sourcesContent":["import React, { useState, useCallback, useEffect, useGlobal } from 'reactn';\nimport { Text, Modal, View, Image, Pressable } from 'react-native';\nimport moment from 'moment';\n\nimport RNShake from '../../lib';\n\nimport { uploadToCloud } from '../actions/userActions';\n\nimport cloudInstance from '../config/cloud';\n\nimport { SharedStyles, Fonts, Palette } from '../styles';\n\nimport { icons } from '../assets/';\nimport Button from '../components/Buttons/Button';\nimport Input from '../components/Inputs/Input';\n\nconst stepList = [\n  { title: 'Envoyer un nouveau rapport' },\n  { title: 'Description du problème' },\n];\n\nexport default ({ projectID = null, children }) => {\n  const [, setTooltip] = useGlobal('_tooltip');\n  const [, setIsLoading] = useGlobal('_isLoading');\n\n  const [showModal, setShowModal] = useState(false);\n  const [step, setStep] = useState(0);\n\n  const [screenshotURI, setScreenshotURI] = useState(null);\n  const [description, setDescription] = useState(__DEV__ ? 'teeeeeeeest' : '');\n\n  React.useEffect(() => {\n    const subscription = RNShake.addListener((data) => {\n      console.log('hello', data);\n      setScreenshotURI(data);\n      setShowModal(true);\n    });\n\n    return () => {\n      subscription?.remove?.();\n    };\n  }, []);\n\n  useEffect(() => {\n    if (showModal === false) {\n      setScreenshotURI(null);\n      setDescription('');\n      setStep(0);\n    }\n  }, [showModal]);\n\n  const submitShake = async () => {\n    try {\n      if (description.length < 5) {\n        throw new Error('Description trop courte');\n      }\n\n      if (description.length > 250) {\n        throw new Error('Description trop longue');\n      }\n\n      if (!screenshotURI) {\n        throw new Error(\"Aucune capture d'écran détectée...\");\n      }\n\n      setIsLoading(true);\n      setTooltip({ text: 'Publication en cours ...' });\n\n      const { uri } = await uploadToCloud({\n        path: `shakes/${projectID}/${moment().valueOf()}.jpg`,\n        uri: screenshotURI,\n      });\n\n      await cloudInstance.functions().httpsCallable('shakes-submitNewShake')({\n        screenshot: uri,\n        description,\n        projectID,\n      });\n\n      setTooltip({ text: 'Publication effectuée !' });\n      setShowModal(false);\n    } catch (e) {\n      console.log(e.message);\n      setTooltip({ text: e.message });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const Header = useCallback(() => {\n    return (\n      <View\n        style={[\n          SharedStyles.containerRowSpaceBetween,\n          { backgroundColor: Palette.darkPurple, padding: 20 },\n        ]}\n      >\n        <Pressable\n          onPress={() => {\n            if (step === 0) {\n              setShowModal(false);\n            } else {\n              setStep(step - 1);\n            }\n          }}\n        >\n          <Image\n            resizeMode=\"contain\"\n            source={icons.back}\n            style={{ height: 30, width: 30, tintColor: Palette.mainWhite }}\n          />\n        </Pressable>\n\n        <Image\n          resizeMode=\"contain\"\n          source={require('../assets/images/logoFull.png')}\n          style={{ height: 30, width: 150 }}\n        />\n\n        <View style={{ width: 30 }} />\n      </View>\n    );\n  }, [step]);\n\n  return (\n    <>\n      <Pressable style={{ flex: 1 }}>\n        <View style={{ flex: 1 }}>{children}</View>\n      </Pressable>\n\n      <Modal\n        animationType=\"slide\"\n        visible={showModal}\n        onRequestClose={() => {\n          setShowModal(!showModal);\n        }}\n        presentationStyle={'formSheet'}\n      >\n        <Header />\n\n        <View\n          style={{\n            flex: 1,\n            padding: 20,\n            backgroundColor: '#13131a',\n          }}\n        >\n          <Text\n            style={[\n              Fonts.primary.bold(17, Palette.mainWhite),\n              { textAlign: 'center', marginBottom: 20 },\n            ]}\n          >\n            {stepList[step].title}\n          </Text>\n\n          {!step ? (\n            <View style={{ flex: 0.8, borderRadius: 10, overflow: 'hidden' }}>\n              <Image\n                resizeMode={'cover'}\n                style={{ flex: 1 }}\n                source={{\n                  uri: screenshotURI,\n                }}\n              />\n            </View>\n          ) : (\n            <Input\n              style={{ height: 300, backgroundColor: Palette.mainWhite }}\n              value={description}\n              onChange={setDescription}\n              isTextarea\n            />\n          )}\n\n          <Button\n            text={step === stepList.length - 1 ? 'Envoyer' : 'Continuer'}\n            primary\n            isAbsoluteBottom\n            textColor={Palette.mainWhite}\n            onPress={() => {\n              if (step === stepList.length - 1) {\n                submitShake();\n              } else {\n                setStep(step + 1);\n              }\n            }}\n          />\n        </View>\n      </Modal>\n    </>\n  );\n};\n"],"mappings":"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"}